<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="trip.dao.TripBoardDao">

<insert id="insertBoard" parameterType="tripBoard">
<selectKey order="BEFORE" keyProperty="trip_Board_Key" resultType="int">
	select TRIP_BOARD_TB_SEQ.nextval from dual
</selectKey>
insert into TRIP_BOARD_TB
   (TRIP_BOARD_KEY,
	USER_NUM,
	TRIP_BOARD_TITLE,
	TRIP_BOARD_COUNTENT,
	TRIP_BOARD_START,
	TRIP_BOARD_END,
	TRIP_BOARD_TOGETHER)
values(#{trip_Board_Key},
	  #{user_Num},
	  #{trip_Board_Title},
	  #{trip_Board_Content},
	  #{trip_Board_Start},
	  #{trip_Board_End},
	  #{trip_Board_Together})
</insert>

<select id="selectOneByBoardKey" parameterType="int" resultType="tripBoard">

selcect *
from TRIP_BOARD_TB
where TRIP_BOARD_KEY = #{trip_Board_Key}

</select>

<select id="selectOneByUserNum" parameterType="int" resultType="tripBoard">

select * 
from TRIP_BOARD_TB
where USER_NUM = #{num}

</select>

<select id="selectAll" resultType="tripBoard">

select * 
from TRIP_BOARD_TB

</select>


<select id="getTenBoardPage" parameterType="map" resultType="tripboard">
select *
from (select rownum as r,TRIP_BOARD_KEY,USER_NUM,TRIP_BOARD_TITLE,TRIP_BOARD_COUNTENT,TRIP_BOARD_START,TRIP_BOARD_END,TRIP_BOARD_TOGETHER,TRIP_BOARD_READCOUNT,TRIP_BOARD_ST,rcount
      from   (select b.TRIP_BOARD_KEY,b.USER_NUM,b.TRIP_BOARD_TITLE,b.TRIP_BOARD_COUNTENT,b.TRIP_BOARD_START,b.TRIP_BOARD_END,b.TRIP_BOARD_TOGETHER,b.TRIP_BOARD_READCOUNT,b.TRIP_BOARD_ST,count(r.TRIP_REPLY_KEY) as rcount
              from TRIP_BOARD_TB b left outer join TRIP_REPLY_TB r
              on b.TRIP_BOARD_KEY = r.TRIP_BOARD_KEY
              group by b.TRIP_BOARD_KEY,b.USER_NUM,b.TRIP_BOARD_TITLE,b.TRIP_BOARD_COUNTENT,b.TRIP_BOARD_START,b.TRIP_BOARD_END,b.TRIP_BOARD_TOGETHER,b.TRIP_BOARD_READCOUNT,b.TRIP_BOARD_ST
              order by TRIP_BOARD_KEY desc))
where r between #{start} and #{end}



</select>

<select id="getTotalCount" resultType="tripBoard">

select count(*)
from TRIP_BOARD_TB

</select>

<!--도시 테이블 메소드  -->
<insert id="insertCity" parameterType="tripCity">
<selectKey order="BEFORE" keyProperty="trip_City_Key" resultType="int">
select TRIP_CITY_TB_SEQ.nextval from dual
</selectKey>
insert into TRIP_CITY_TB
values(	#{trip_City_Key},
		#{trip_City_Town},
		#{trip_City_Lat},
		#{trip_City_Lng},
		#{trip_City_Lng})


</insert>

<select id="selectOneByCity" parameterType="map" resultType="tripCity">
select *
from TRIP_CITY_TB
where 1=0
<if test="key!=null">
or TRIP_CITY_KEY = ('${key}')
</if>
<if test="town!=null">
or TRIP_CITY_TOWN = ('${town}')
</if>
<if test="lat!=null">
or TRIP_CITY_LAT = ('${lat}')
</if>
<if test="lng!=null">
or TRIP_CITY_LNG = ('${lng}')
</if>
<if test="pid!=null">
or TRIP_CITY_PID = ('${pid}')
</if>


</select>

<select id="selectAllByCity" resultType="tripCity">

select * 
from TRIP_CITY_TB

</select>


<!--도시 테이블 메소드 끝  -->
<!--관계 테이블 메소드  -->
<insert id="insertRel" parameterType="tripRel">
insert into TRIP_REL_TB
values(TRIP_REL_TB_SEQ.nextval,#{trip_Board_Key},#{trip_City_Key},#{user_Num})
</insert>






</mapper>